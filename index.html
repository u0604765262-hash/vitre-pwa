<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bulle de Savon - Nettoyage Vitres</title>

  <!-- ‚úÖ Favicon (conserv√©) -->
  <link rel="icon" href="logo1.png" type="image/png">
  <meta name="theme-color" content="#0F384D">

  <!-- ‚úÖ Police Antic Slab -->
  <link href="https://fonts.googleapis.com/css2?family=Antic+Slab&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary: #0F384D;         /* Couleur de marque */
      --primary-600: #0C2C3A;     /* Hover */
      --bg: #f4f6f8;
      --card: #ffffff;
      --text: #2b2b2b;
      --muted: #6b7280;
      --success: #22c55e;
      --danger: #ef4444;
      --shadow: 0 6px 18px rgba(0,0,0,0.08);
      --radius: 14px;
    }

    /* Base */
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      font-family: 'Antic Slab', serif;
      margin: 0;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
    }

    a { color: var(--primary); text-decoration: none; }
    img { max-width: 100%; display: block; }
    .container { width: min(1100px, 92%); margin: 0 auto; }

    /* Header */
    header { position: sticky; top: 0; z-index: 50; background: #fff; box-shadow: var(--shadow); }
    .nav { display:flex; align-items:center; justify-content:space-between; gap:16px; padding:10px 0; }
    .brand { display:flex; align-items:center; gap:12px; }
    .brand img { height: 56px; }
    .brand h1 { font-size: 20px; margin: 0; color: var(--primary); letter-spacing: .2px; }
    .cta-header { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .btn { display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:12px 18px; border-radius: 999px; font-weight: 700; border: 0; cursor:pointer; transition: .2s transform ease, .25s box-shadow ease; box-shadow: var(--shadow); font-family:'Antic Slab', serif; }
    .btn:hover { transform: translateY(-1px); }
    .btn-primary { background: var(--primary); color: #fff; }
    .btn-primary:hover { background: var(--primary-600); }
    .btn-ghost { background: #fff; color: var(--primary); border:2px solid rgba(15,56,77,.2); }

    /* Hero */
    .hero { background: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%); padding: 36px 0 24px; border-bottom: 1px solid #eef2f7; }
    .hero-grid { display:grid; grid-template-columns: 1.15fr .85fr; gap: 28px; align-items:center; }
    .hero h2 { font-size: clamp(28px, 4vw, 40px); margin: 0 0 8px; color: var(--primary); }
    .hero p.lead { font-size: clamp(16px, 2vw, 18px); color:#475569; margin: 0 0 18px; }
    .hero .badges { display:flex; gap:10px; flex-wrap:wrap; margin: 12px 0 16px; }
    .badge { background:#eaf1f5; color:#0F384D; border:1px solid #d3e0e8; padding:8px 12px; border-radius:999px; font-weight:600; font-size:14px; font-family:'Antic Slab', serif; }
    .hero-card { background: var(--card); padding:18px; border-radius: var(--radius); box-shadow: var(--shadow); }
    .usp { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    .usp .item { display:flex; align-items:flex-start; gap:10px; background:#f9fbfd; border:1px solid #e6eef5; padding:12px; border-radius:12px; }
    .usp .item .icon { font-size:20px; }

    /* Sections */
    section { padding: 28px 0; }
    .section-title { font-size: 22px; color:#0f172a; margin: 0 0 8px; }
    .section-sub { color:#64748b; margin: 0 0 18px; }

    /* Services */
    .cards { display:grid; grid-template-columns: repeat(3,1fr); gap:16px; }
    .card { background:#fff; border-radius: var(--radius); padding:16px; box-shadow: var(--shadow); border:1px solid #eef2f7; }
    .card h3 { margin:0 0 6px; font-size:18px; color:#0f172a; }
    .card p { margin:0; color:#616e7c; font-size:15px; }

    /* Galerie */
    .masonry { columns: 1; column-gap: 12px; }
    @media (min-width: 640px) { .masonry { columns: 2; } }
    @media (min-width: 960px) { .masonry { columns: 3; } }
    .masonry figure { break-inside: avoid; background:#fff; margin:0 0 12px; border-radius: 12px; overflow:hidden; box-shadow: var(--shadow); border:1px solid #eef2f7; }
    .masonry figcaption { padding:10px 12px; font-size:14px; color:#475569; }

    /* √âtapes */
    .steps { display:grid; grid-template-columns: repeat(4,1fr); gap:14px; }
    .step { background:#fff; border:1px solid #eef2f7; border-radius: 12px; padding:14px; box-shadow: var(--shadow); }
    .step .num { font-weight:800; color:#0ea5e9; font-size:14px; }
    .step h4 { margin:6px 0 6px; font-size:16px; }
    .step p { margin:0; color:#64748b; font-size:14px; }

    /* Avis Google */
    .reviews { display:grid; gap:16px; margin-top:20px; }
    .review { background:#fff; border-radius: var(--radius); padding:16px; box-shadow: var(--shadow); border:1px solid #eef2f7; }
    .review-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; }
    .review-name { font-weight:700; color:#0F384D; }
    .stars { color:#f59e0b; }

    /* Formulaire */
    .form-wrap { background:#fff; border-radius: var(--radius); box-shadow: var(--shadow); border:1px solid #eef2f7; padding: 18px; }
    form .grid { display:grid; grid-template-columns: 1fr; gap:12px; }
    @media (min-width: 720px) { form .grid.two { grid-template-columns: 1fr 1fr; } }
    label { display:block; font-weight:700; font-size:14px; color:#0f172a; margin-bottom:6px; }
    .hint { font-size:12px; color:#6b7280; margin-top:4px; }
    input[type="text"], input[type="email"], input[type="tel"], input[type="datetime-local"], textarea, select { width:100%; padding:12px 12px; border-radius:10px; border:1px solid #d7dee6; outline: none; background:#fbfdff; font-size:15px; font-family:'Antic Slab', serif; }
    textarea { min-height: 110px; resize: vertical; }
    .check-group { display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:10px; }
    .checkbox { display:flex; align-items:flex-start; gap:10px; background:#f9fbfd; border:1px solid #e6eef5; padding:10px 12px; border-radius:10px; }

    /* Footer */
    footer { color:#64748b; font-size: 13px; text-align:center; padding: 18px 12px 28px; }
    footer .links { display:flex; justify-content:center; gap:16px; flex-wrap:wrap; }

    /* Cookies (conserv√©) */
    #cookie-banner { position: fixed; bottom: 20px; right: 20px; max-width: 280px; background: #222; color: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.3); z-index: 10000; font-size: 14px; display: none; }
    #cookie-banner .cookie-buttons { margin-top: 10px; text-align: right; }
    #cookie-banner button { margin-left: 5px; padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
    #cookie-accept { background: #28a745; color: #fff; }
    #cookie-reject { background: #dc3545; color: #fff; }
    #cookie-accept:hover { background: #218838; }
    #cookie-reject:hover { background: #b02a37; }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="container nav">
      <div class="brand">
        <img src="logo.png" alt="Logo Bulle de Savon" />
        <h1>Bulle de Savon</h1>
      </div>
      <div class="cta-header">
        <a class="btn btn-ghost" href="tel:+33618100807">üìû 06 18 10 08 07</a>
        <a class="btn btn-primary" href="#devis">Demander une visite & devis</a>
      </div>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <div class="container hero-grid">
      <div>
        <h2>Nettoyage de vitres impeccable pour <em>particuliers</em> & <em>professionnels</em></h2>
        <p class="lead">Fini le calcul automatique. Ici, on vient voir, on conseille, et on fixe un <strong>prix juste</strong> sur place ‚Äî sans mauvaise surprise.</p>
        <div class="badges">
          <span class="badge">‚úÖ Intervention locale</span>
          <span class="badge">üßº Mat√©riel pro</span>
          <span class="badge">üí¨ Devis gratuit & rapide</span>
        </div>
        <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
          <a class="btn btn-primary" href="#devis">Je veux un devis sur place</a>
          <a class="btn btn-ghost" href="#galerie">Voir des r√©sultats</a>
        </div>
      </div>
      <div class="hero-card">
        <div class="usp">
          <div class="item"><div class="icon">üè†</div><div>
            <strong>Particuliers</strong><br><span class="muted">Fen√™tres, baies vitr√©es, v√©randas, velux‚Ä¶</span>
          </div></div>
          <div class="item"><div class="icon">üè™</div><div>
            <strong>Commerces</strong><br><span class="muted">Vitrines, portes automatiques, garde-corps‚Ä¶</span>
          </div></div>
          <div class="item"><div class="icon">üßΩ</div><div>
            <strong>Finition soign√©e</strong><br><span class="muted">Angles, encadrements, traces difficiles</span>
          </div></div>
          <div class="item"><div class="icon">üïë</div><div>
            <strong>Cr√©neaux flexibles</strong><br><span class="muted">Nous nous adaptons √† vos horaires</span>
          </div></div>
        </div>
      </div>
    </div>
  </section>

  <!-- Services -->
  <section class="container" id="services">
    <h3 class="section-title">Prestations principales</h3>
    <p class="section-sub">Dites-nous ce dont vous avez besoin : nous passons, √©valuons sur place, puis nous vous donnons le prix exact.</p>
    <div class="cards">
      <article class="card"><h3>Vitres & fen√™tres</h3><p>Int√©rieur / ext√©rieur, encadrements et finitions incluses.</p></article>
      <article class="card"><h3>Baies vitr√©es & v√©randas</h3><p>Grands formats, acc√®s difficile, perches t√©lescopiques.</p></article>
      <article class="card"><h3>Vitrines de commerces</h3><p>Entretien r√©gulier ou passage ponctuel avant √©v√©nement.</p></article>
    </div>
  </section>

  <!-- Galerie -->
  <section class="container" id="galerie">
    <h3 class="section-title">Avant / Apr√®s</h3>
    <p class="section-sub">Quelques r√©alisations r√©centes. Remplacez ces images par vos photos.</p>
    <div class="masonry">
      <figure>
        <img src="photos/apres-1.jpg" alt="R√©sultat nettoyage 1" loading="lazy">
        <figcaption>Vitrine ‚Äì centre-ville</figcaption>
      </figure>
      <figure>
        <img src="photos/apres-2.jpg" alt="R√©sultat nettoyage 2" loading="lazy">
        <figcaption>V√©randa ‚Äì particulier</figcaption>
      </figure>
      <figure>
        <img src="photos/apres-3.jpg" alt="R√©sultat nettoyage 3" loading="lazy">
        <figcaption>Baie vitr√©e ‚Äì maison</figcaption>
      </figure>
      <figure>
        <img src="photos/apres-4.jpg" alt="R√©sultat nettoyage 4" loading="lazy">
        <figcaption>Vitres d‚Äôangle ‚Äì commerce</figcaption>
      </figure>
      <figure>
        <img src="photos/apres-5.jpg" alt="R√©sultat nettoyage 5" loading="lazy">
        <figcaption>Velux ‚Äì √©tage</figcaption>
      </figure>
    </div>
  </section>

  <!-- √âtapes -->
  <section class="container" id="etapes">
    <h3 class="section-title">Comment √ßa se passe ?</h3>
    <div class="steps">
      <div class="step"><div class="num">1/4</div><h4>Vous d√©crivez votre besoin</h4><p>Un petit formulaire, quelques photos si besoin.</p></div>
      <div class="step"><div class="num">2/4</div><h4>Visite rapide</h4><p>On passe sur place pour valider l‚Äôacc√®s et la surface.</p></div>
      <div class="step"><div class="num">3/4</div><h4>Prix clair</h4><p>Le tarif est fix√© avec vous, sans surprise.</p></div>
      <div class="step"><div class="num">4/4</div><h4>Intervention</h4><p>On intervient au cr√©neau qui vous arrange.</p></div>
    </div>
  </section>

  <!-- Avis clients (dynamique Google) -->
  <section class="container" id="avis">
    <h3 class="section-title">Avis clients</h3>
    <p class="section-sub">
      Avis v√©rifi√©s Google (charg√©s via l‚ÄôAPI Places). Si rien ne s‚Äôaffiche, v√©rifiez la cl√© API, les restrictions de domaine et la facturation.
    </p>

    <div id="googleReviews" class="reviews"></div>

    <div style="margin-top:16px; display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
      <a id="gmapsLink" class="btn btn-primary" target="_blank" rel="noopener">Voir plus d‚Äôavis sur Google</a>
      <span class="hint">Astuce : ouvre la console (F12) pour voir quelle fiche est trouv√©e.</span>
    </div>
  </section>

  <!-- Formulaire Devis / Demande de prestation -->
  <section class="container" id="devis">
    <h3 class="section-title">Demande de prestation / devis</h3>
    <p class="section-sub">Gratuit et sans engagement. Nous revenons vers vous tr√®s vite pour planifier une visite et vous donner le prix exact.</p>

    <div class="form-wrap">
      <form id="requestForm" novalidate>
        <div class="grid two">
          <div>
            <label for="fullname">Nom & pr√©nom *</label>
            <input id="fullname" name="fullname" type="text" autocomplete="name" required>
          </div>
          <div>
            <label for="phone">T√©l√©phone *</label>
            <input id="phone" name="phone" type="tel" inputmode="tel" placeholder="06‚Ä¶" required>
            <div class="hint">On vous appelle seulement pour fixer un cr√©neau.</div>
          </div>
        </div>

        <div class="grid two">
          <div>
            <label for="email">Email</label>
            <input id="email" name="email" type="email" autocomplete="email" placeholder="contact@exemple.fr">
          </div>
          <div>
            <label for="clientType">Vous √™tes *</label>
            <select id="clientType" name="clientType" required>
              <option value="">S√©lectionner‚Ä¶</option>
              <option>Particulier</option>
              <option>Professionnel</option>
              <option>Association / Copropri√©t√©</option>
            </select>
          </div>
        </div>

        <div>
          <label for="address">Adresse d‚Äôintervention *</label>
          <input id="address" name="address" type="text" placeholder="N¬∞, rue, ville" required>
          <div class="hint">Pr√©cisez l‚Äô√©tage et les informations d‚Äôacc√®s si utile.</div>
        </div>

        <div>
          <label>Type de prestation souhait√©e (cochez ce qui s‚Äôapplique)</label>
          <div class="check-group">
            <label class="checkbox"><input type="checkbox" name="services" value="Fen√™tres"> Fen√™tres / ch√¢ssis</label>
            <label class="checkbox"><input type="checkbox" name="services" value="Baies"> Baies vitr√©es</label>
            <label class="checkbox"><input type="checkbox" name="services" value="V√©randa"> V√©randa</label>
            <label class="checkbox"><input type="checkbox" name="services" value="Vitrine"> Vitrine commerce</label>
            <label class="checkbox"><input type="checkbox" name="services" value="Velux"> Velux</label>
            <label class="checkbox"><input type="checkbox" name="services" value="Autre"> Autre</label>
          </div>
        </div>

        <div class="grid two">
          <div>
            <label for="slot">Cr√©neau souhait√©</label>
            <input id="slot" name="slot" type="datetime-local">
          </div>
          <div>
            <label for="frequency">Fr√©quence</label>
            <select id="frequency" name="frequency">
              <option value="Ponctuel">Ponctuel</option>
              <option value="Mensuel">Mensuel</option>
              <option value="Trimestriel">Trimestriel</option>
              <option value="Semestriel">Semestriel</option>
            </select>
          </div>
        </div>

        <div>
          <label for="message">Pr√©cisions utiles</label>
          <textarea id="message" name="message" placeholder="Surface approximative, acc√®s, hauteur, traces sp√©cifiques, etc."></textarea>
        </div>

        <div>
          <label>Photos (facultatif)</label>
          <div id="dropzone" class="dropzone">
            Glissez-d√©posez des images ici ou <strong>cliquez</strong> pour s√©lectionner.
            <input id="photos" name="photos" type="file" accept="image/*" multiple style="display:none">
          </div>
          <div class="hint">Les pi√®ces jointes seront envoy√©es si votre point de terminaison le permet. Sinon, on vous proposera de r√©pondre √† l‚Äôemail avec les photos.</div>
          <div id="preview" class="preview"></div>
        </div>

        <!-- Anti-spam honeypot -->
        <input type="text" id="company" name="company" style="position:absolute; left:-9999px; top:-9999px;" tabindex="-1" autocomplete="off" aria-hidden="true">

        <div class="consent">
          <input id="consent" type="checkbox" required>
          <label for="consent">J‚Äôaccepte d‚Äô√™tre contact√© par Bulle de Savon pour ma demande. Mes donn√©es ne seront pas partag√©es √† des tiers. (<a href="mentions-legales.html">Confidentialit√©</a>)</label>
        </div>

        <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top:6px;">
          <button class="btn btn-primary" type="submit">Envoyer ma demande</button>
          <a class="btn btn-ghost" href="mailto:contact@bulle-de-savon.fr?subject=Demande%20de%20prestation%20vitres">Ou par email</a>
          <span id="formStatus" class="hint"></span>
        </div>
      </form>
    </div>
  </section>

  <!-- FAQ -->
  <section class="container" id="faq">
    <h3 class="section-title">Questions fr√©quentes</h3>
    <details>
      <summary>Comment calculez-vous le tarif ?</summary>
      <p>Nous venons sur place pour √©valuer l‚Äôacc√®s, la surface et l‚Äô√©tat des vitres. Le prix est fix√© et valid√© avec vous avant toute intervention.</p>
    </details>
    <details>
      <summary>Faut-il √™tre pr√©sent ?</summary>
      <p>Id√©alement pour la premi√®re visite, oui. Ensuite, nous pouvons convenir d‚Äôun mode d‚Äôacc√®s s√©curis√©.</p>
    </details>
    <details>
      <summary>Intervenez-vous le samedi ou t√¥t le matin ?</summary>
      <p>Oui, nous nous adaptons √† vos contraintes horaires (commerces notamment).</p>
    </details>
  </section>

  <!-- Footer -->
  <footer>
    <div class="links">
      <a href="mentions-legales.html">Mentions l√©gales & Politique de confidentialit√©</a>
      <span>‚Ä¢</span>
      <a href="mailto:contact@bulle-de-savon.fr">contact@bulle-de-savon.fr</a>
      <span>‚Ä¢</span>
      <a href="tel:+33618100807">06 18 10 08 07</a>
      <span>‚Ä¢</span>
      <a href="#devis">Demander un devis</a>
    </div>
  </footer>

  <!-- ‚úÖ Banni√®re cookies -->
  <div id="cookie-banner">
    üç™ Ce site utilise des cookies pour mesurer l‚Äôaudience (Google Analytics).
    <div class="cookie-buttons">
      <button id="cookie-accept">Accepter</button>
      <button id="cookie-reject">Refuser</button>
    </div>
  </div>

  <script>
    /* ======== JS page ======== */
    // Smooth scroll
    document.querySelectorAll('a[href^="#"]').forEach(a => {
      a.addEventListener('click', e => {
        const id = a.getAttribute('href');
        if (id.length > 1) {
          e.preventDefault();
          document.querySelector(id)?.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      });
    });

    // Dropzone
    const dz = document.getElementById('dropzone');
    const fileInput = document.getElementById('photos');
    const preview = document.getElementById('preview');

    dz.addEventListener('click', () => fileInput.click());
    dz.addEventListener('dragover', e => { e.preventDefault(); dz.classList.add('drag'); });
    dz.addEventListener('dragleave', () => dz.classList.remove('drag'));
    dz.addEventListener('drop', e => {
      e.preventDefault(); dz.classList.remove('drag');
      fileInput.files = e.dataTransfer.files;
      renderPreviews();
    });
    fileInput.addEventListener('change', renderPreviews);

    function renderPreviews(){
      preview.innerHTML = '';
      const files = Array.from(fileInput.files || []);
      files.slice(0,8).forEach(file => {
        const url = URL.createObjectURL(file);
        const img = document.createElement('img');
        img.src = url; img.alt = file.name; img.loading = 'lazy';
        preview.appendChild(img);
      });
    }

    // Form handling
    const form = document.getElementById('requestForm');
    const statusEl = document.getElementById('formStatus');

    // ‚öôÔ∏è Configurez ceci si vous avez un endpoint (Formspree/Make/Zapier/Netlify/serveur)
    const FORM_ENDPOINT = '';

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      statusEl.textContent = '';

      // Honeypot
      if (document.getElementById('company').value.trim() !== '') return;

      // Validation simple
      const requiredIds = ['fullname','phone','clientType','address','consent'];
      for (const id of requiredIds) {
        const el = document.getElementById(id);
        if ((el.type === 'checkbox' && !el.checked) || (el.value || '').trim() === '') {
          el.focus();
          statusEl.textContent = 'Merci de compl√©ter les champs marqu√©s *.';
          statusEl.style.color = '#ef4444';
          return;
        }
      }

      const data = new FormData(form);

      if (FORM_ENDPOINT) {
        try {
          const res = await fetch(FORM_ENDPOINT, { method: 'POST', body: data });
          if (!res.ok) throw new Error('HTTP ' + res.status);
          form.reset(); preview.innerHTML = '';
          statusEl.textContent = 'Merci ! Votre demande a bien √©t√© envoy√©e. Nous vous recontactons tr√®s vite.';
          statusEl.style.color = '#16a34a';
        } catch (err) {
          statusEl.textContent = "√âchec de l'envoi. Vous pouvez nous joindre au 06 18 10 08 07 ou par email.";
          statusEl.style.color = '#ef4444';
        }
      } else {
        // Fallback mailto (pi√®ces jointes non prises en charge)
        const services = Array.from(form.querySelectorAll('input[name="services"]:checked')).map(el => el.value).join(', ');
        const subject = encodeURIComponent('Demande de prestation vitres');
        const body = encodeURIComponent(
`Nom: ${data.get('fullname')}
T√©l√©phone: ${data.get('phone')}
Email: ${data.get('email') || ''}
Type: ${data.get('clientType')}
Adresse: ${data.get('address')}
Cr√©neau souhait√©: ${data.get('slot') || ''}
Fr√©quence: ${data.get('frequency') || 'Ponctuel'}
Prestations: ${services || '‚Äî'}
\nMessage:\n${data.get('message') || '‚Äî'}\n\n(Photos √† envoyer en r√©ponse √† l‚Äôemail si besoin)`);
        window.location.href = `mailto:contact@bulle-de-savon.fr?subject=${subject}&body=${body}`;
      }
    });
  </script>

  <!-- === Avis Google dynamiques (robuste) === -->
  <script>
    const GOOGLE_PLACES = {
      API_KEY: 'AIzaSyDkaBdmo0KQ8iWol2ZIgUKEsOIhe2tld-M',   // ‚ö†Ô∏è restreins aux r√©f√©rents bulle-de-savon.fr + http://localhost/*
      PLACE_ID: 'ChIJBU4SvmCv9oERPHIX2gvzLkE',              // si c‚Äôest bien le tien, il sera utilis√© en priorit√©
      QUERY_VARIANTS: [
        'Bulle de Savon, 94700 Maisons-Alfort',
        '"Bulle de Savon" nettoyage de vitres Maisons-Alfort',
        'Bulle de savon vitres Maisons-Alfort 94700'
      ],
      CITY_FILTER: 'Maisons-Alfort',
      POSTAL_FILTER: '94700',
      LOCATION: { lat: 48.79, lng: 2.45 },
      SEARCH_RADIUS: 12000,
      MAX_REVIEWS: 6
    };

    function renderPlace(place){
      const reviewsEl = document.getElementById('googleReviews');
      const linkEl    = document.getElementById('gmapsLink');
      if (!place){
        reviewsEl.innerHTML = '<div class="review">Impossible de charger les avis pour le moment.</div>';
        linkEl.href = 'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(GOOGLE_PLACES.QUERY_VARIANTS[0]);
        return;
      }
      const list = (place.reviews || []).slice(0, GOOGLE_PLACES.MAX_REVIEWS);
      reviewsEl.innerHTML = list.length ? '' : '<div class="review">Aucun avis publi√© pour l‚Äôinstant.</div>';
      list.forEach(r => {
        const el = document.createElement('div');
        el.className = 'review';
        el.innerHTML = `
          <div class="review-header">
            <span class="review-name">${r.author_name || 'Client Google'}</span>
            <span class="stars" aria-label="${r.rating} √©toiles">
              ${'‚òÖ'.repeat(Math.round(r.rating))}${'‚òÜ'.repeat(5 - Math.round(r.rating))}
            </span>
          </div>
          <p>${r.text || ''}</p>
          <div class="hint">${new Date(r.time*1000).toLocaleDateString('fr-FR')}</div>
        `;
        reviewsEl.appendChild(el);
      });
      linkEl.href = place.url || ('https://www.google.com/maps/place/?q=place_id:' + (place.place_id || ''));
      linkEl.textContent = `Voir ${place.user_ratings_total || ''} avis sur Google`;
    }

    function initGoogleReviews(){
      const reviewsEl = document.getElementById('googleReviews');
      const linkEl    = document.getElementById('gmapsLink');
      const svc = new google.maps.places.PlacesService(document.createElement('div'));

      function getDetails(placeId){
        console.log('[getDetails] placeId=', placeId);
        svc.getDetails({
          placeId,
          fields: ['name','rating','user_ratings_total','url','reviews','place_id','formatted_address','geometry']
        }, (place, status) => {
          console.log('[getDetails:status]', status, place?.name, place?.formatted_address);
          if (status === google.maps.places.PlacesServiceStatus.OK) {
            renderPlace(place);
          } else if (status === google.maps.places.PlacesServiceStatus.NOT_FOUND ||
                     status === google.maps.places.PlacesServiceStatus.INVALID_REQUEST) {
            findPlaceRobust();
          } else {
            reviewsEl.innerHTML = `<div class="review">Erreur Google Places : <strong>${status}</strong></div>`;
            linkEl.href = 'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(GOOGLE_PLACES.QUERY_VARIANTS[0]);
          }
        });
      }

      function keepCandidate(r){
        const addr = (r.formatted_address || r.vicinity || '').toLowerCase();
        const okCity  = GOOGLE_PLACES.CITY_FILTER && addr.includes(GOOGLE_PLACES.CITY_FILTER.toLowerCase());
        const okZip   = GOOGLE_PLACES.POSTAL_FILTER && addr.includes(GOOGLE_PLACES.POSTAL_FILTER);
        return okCity || okZip;
      }

      function findPlaceRobust(){
        const loc = new google.maps.LatLng(GOOGLE_PLACES.LOCATION.lat, GOOGLE_PLACES.LOCATION.lng);
        const variants = GOOGLE_PLACES.QUERY_VARIANTS.slice();

        function tryNext(){
          const q = variants.shift();
          if (!q) { reviewsEl.innerHTML = '<div class="review">Fiche introuvable avec le nom fourni.</div>'; return; }

          console.log('[findPlaceFromQuery] ‚Üí', q);
          svc.findPlaceFromQuery({ query: q, fields: ['place_id','name','formatted_address','geometry'], locationBias: loc },
            (res, status) => {
              console.log('[findPlaceFromQuery:status]', status, res?.map(r=>r.name));
              if (status === google.maps.places.PlacesServiceStatus.OK && res && res.length) {
                const filtered = res.filter(keepCandidate);
                const chosen = filtered[0] || res[0];
                console.log('[findPlaceFromQuery:chosen]', chosen?.name, chosen?.formatted_address);
                getDetails(chosen.place_id);
              } else {
                console.log('[textSearch] ‚Üí', q);
                svc.textSearch({ query: q, location: loc, radius: GOOGLE_PLACES.SEARCH_RADIUS },
                  (results, st) => {
                    console.log('[textSearch:status]', st, results?.map(r=>r.name));
                    if (st === google.maps.places.PlacesServiceStatus.OK && results && results.length){
                      const filtered = results.filter(keepCandidate);
                      const chosen = filtered[0] || results[0];
                      console.log('[textSearch:chosen]', chosen?.name, chosen?.formatted_address);
                      getDetails(chosen.place_id);
                    } else {
                      tryNext();
                    }
                  });
              }
            });
        }
        tryNext();
      }

      if (GOOGLE_PLACES.PLACE_ID) getDetails(GOOGLE_PLACES.PLACE_ID);
      else findPlaceRobust();
    }

    (function loadMaps(){
      const s = document.createElement('script');
      s.src = `https://maps.googleapis.com/maps/api/js?key=${GOOGLE_PLACES.API_KEY}&libraries=places&language=fr&callback=initGoogleReviews`;
      s.async = true; s.defer = true;
      s.onerror = () => {
        const reviewsEl = document.getElementById('googleReviews');
        const linkEl = document.getElementById('gmapsLink');
        if (reviewsEl) reviewsEl.innerHTML = '<div class="review">Google Maps JS ne s‚Äôest pas charg√© (cl√© / restrictions ?).</div>';
        if (linkEl) linkEl.href = 'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(GOOGLE_PLACES.QUERY_VARIANTS[0]);
      };
      document.head.appendChild(s);
    })();
  </script>

  <script>
    /* ---------- COOKIES (conserv√©) ---------- */
    const cookieBanner = document.getElementById("cookie-banner");
    const acceptBtn = document.getElementById("cookie-accept");
    const rejectBtn = document.getElementById("cookie-reject");

    function loadAnalytics() {
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-PC3K8HGL');

      var gaScript = document.createElement("script");
      gaScript.async = true;
      gaScript.src = "https://www.googletagmanager.com/gtag/js?id=G-NGR43J81FE";
      document.head.appendChild(gaScript);

      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);} 
      window.gtag = gtag;

      gtag('js', new Date());
      gtag('config', 'G-NGR43J81FE', { 'anonymize_ip': true });
    }

    const cookieChoice = localStorage.getItem("cookiesAccepted");

    if (cookieChoice === "true") {
      loadAnalytics();
      cookieBanner.style.display = "none";
    } else if (cookieChoice === "false") {
      cookieBanner.style.display = "none";
    } else {
      cookieBanner.style.display = "block";
    }

    acceptBtn.addEventListener("click", () => {
      localStorage.setItem("cookiesAccepted", "true");
      loadAnalytics();
      cookieBanner.style.display = "none";
    });

    rejectBtn.addEventListener("click", () => {
      localStorage.setItem("cookiesAccepted", "false");
      cookieBanner.style.display = "none";
    });
  </script>

  <!-- Service Worker (conserv√©) -->
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("vitre-pwa/service-worker.js")
        .then(reg => console.log("‚úÖ Service Worker enregistr√© :", reg))
        .catch(err => console.error("‚ùå Erreur Service Worker :", err));
    }
  </script>
</body>
</html>
